{% extends 'base.html' %}
{% load static %}

{% block estilo %}
    <link href="{% static 'social/css/social.css' %}" rel="stylesheet">
{% endblock %}

{% block icones %}
    <div class="icones">
        <img class="icone-dash" src="{% static 'cartao_visitas/img/icone-visitas.png' %}">
        <p>Social / </p>
        <img class="icone-menu" src="{% static 'dashboard/img/menu-cinza.png' %}">
    </div>
{% endblock %}

{% block content %}
<div class="container-fluid primeira-linha">
    <h1 class="text-left ml-2 mb-2">Social</h1>
    <button class="adicionar">+</button>
</div>

<div class="formulario-postagem">
    <form method="post" action="{% url 'social' %}" autocomplete='off' enctype='multipart/form-data'>
        {% csrf_token %}

            <input type="hidden" name="user " required="" value={{ perfil.id }}>

            <label for="imagem">Imagem</label>
            <input type="file" name="img" accept="image/*" id="imagem" class="form-control imagem-postagem">

            <label for="texto_postagem">Texto</label>
            <input type="text" class="form-control texto-postagem" name="texto_postagem" placeholder="Digite o Texto da Postagem" id="texto_postagem" required="">
            <button type="submit" class="botao" name="form_post">Postar</button>
        <button class="fechar botao">Cancelar</button>
    </form>
</div>

<div class="contatos sombra">
    <h1 class="mb-2">Contatos</h1>
    <div class="contatos-interno">
        {% for usuario in usuarios %}
        <div class="nome-e-cargo">
                {% if not usuario.foto %}
                    {% if usuario.sexo == 'feminino' %}
                        <img class="foto-perfil" src={% static "usuario/img/avatar-f.jpeg" %}>
                    {% else %}
                        <img class="foto-perfil" src={% static "usuario/img/avatar-m.jpeg" %}>
                    {% endif %}
                {% else %}
                    <img class="foto-perfil" src={{ usuario.foto.url }}>
                {% endif %}
                    <p class="nome-contatos">{{ usuario.nome }} {{ usuario.sobrenome }}</p>
                    {% if usuario.cargo %}
                        <p class="cargo">{{ usuario.cargo }}</p>
                    {% endif %}
        </div>
        {% endfor %}
    </div>
    <a href={% url 'contatos' %} class="link-contatos"> Mais Contatos </a>
</div>


{% for post in postagens %}
<div class="posts sombra">
    <div class="autor">
        {% if not post.user.foto %}
            {% if post.user.sexo == 'feminino' %}
                <img class="img-profile rounded-circle" src="{% static 'usuario/img/avatar-f.jpeg' %}">
            {% else %}
                <img class="img-profile rounded-circle" src="{% static 'usuario/img/avatar-m.jpeg' %}">
            {% endif %}
        {% else %}
            <img class="img-profile rounded-circle"src="{{ post.user.foto.url }}">
        {% endif %}
        <p class="nome">{{post.user.nome}} {{ post.user.sobrenome }}</p>
        <p class="tempo-postagem">{{ post.criado_em|timesince }} atrás</p>
    </div>

    {% if post.texto_postagem %}
        <p class="descricao">{{post.texto_postagem}}</p>
    {% endif %}

    {% if post.img %}
        <img src={{post.img.url}} class="rounded mx-auto d-block">
    {% endif %}

    {% if perfil.id == post.user.id%}
        <a href={% url 'excluir_post' post.id %}>Excluir Postagem</a>
    {% endif %}

    <div class="icones-post">
        <p class="likes-p"><img src={% static 'social/img/like.png' %}> 150</p>
        <p class="comentarios-p"><img src={% static 'social/img/comentario.png' %}>25</p>
    </div>


<!--                Visualização de Comentários               -->

{% for comment in post.comentarios_set.all %}

    <div class="texto-comentario">
        {% if not comment.user.foto %}
            {% if comment.user.sexo == 'feminino' %}
                <img class="img-comentario" src={% static "usuario/img/avatar-f.jpeg" %}>
            {% else %}
                <img class="img-comentario" src={% static "usuario/img/avatar-m.jpeg" %}>
            {% endif %}
        {% else %}
            <img src="{{comment.user.foto.url}}" class="img-comentario">
        {% endif %}

        <p class="nome-comentario">{{comment.user.nome}} {{ comment.user.sobrenome }}</p>
        <p class="texto-comentario-p">{{ comment.texto_comentario }}</p>
        <p class="icone-comentarios-p"><img src={% static 'social/img/like.png' %}>25</p>
    </div>

{% endfor %}
<!--                Fim da Visualização               -->

    <div class="div-comentario">
        <form method="post" action="{% url 'social' %}" autocomplete='off'class="form-inline">
            {% csrf_token %}
        
        {% if not perfil.foto %}
            {% if perfil.sexo == 'feminino' %}
                <img class="img-input-comentario" src={% static "usuario/img/avatar-f.jpeg" %}>
            {% else %}
                <img class="img-input-comentario" src={% static "usuario/img/avatar-m.jpeg" %}>
            {% endif %}
        {% else %}
            <img src="{{perfil.foto.url}}" class="img-input-comentario">
        {% endif %}
            <input type="hidden" name="user" required="" value={{ perfil.id }}>
            <input type="hidden" name="post" required="" value={{ post.id }}>
            <input type="text" class="form-control"placeholder="Escreva o seu comentário" style="width:82%; margin-right: 24px"name="texto_comentario">
            <button type="submit" class="botao-comentar" name="form_comentario">Comentar</button>
        </form>
    </div>
</div>
{% endfor %}


{% endblock %}

{% block scripts %}
<script>
    $(document).on('click', '.adicionar', function(){
        $(".formulario-postagem").css("display","block");
    });
    $(document).on('click', '.fechar', function(){
        $(".formulario-postagem").css("display","none");
    });
</script>
{% endblock %}